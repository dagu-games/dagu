let view_controller={render:function(){view_controller.updateCharacter();view_controller.updateContextMenu();view_controller.updateOutput()},updateCharacter:function(){$("#character_location").text(map.getChunk(util.getChunk(game.character.x,game.character.y).x,util.getChunk(game.character.x,game.character.y).y).name+" ("+game.character.x+","+game.character.y+")");$("#character_level").text(game.character.level);$("#character_experience").text(game.character.experience);$("#character_experience_next_level").text(util.getExperienceNeededForLevel(game.character.level));$("#character_current_health").text(game.character.current_health);$("#character_max_health").text(game.character.max_health);$("#character_current_mana").text(game.character.current_mana);$("#character_max_mana").text(game.character.max_mana);$("#character_armor").text(game.character.armor);$("#character_magic_resistance").text(game.character.magic_resistance);$("#character_cooldown_reduction").text(game.character.cooldown_reduction);$("#character_attack_power").text(game.character.attack_power);$("#character_attack_lifesteal").text(game.character.attack_lifesteal);$("#character_magic_power").text(game.character.magic_power);$("#character_magic_lifesteal").text(game.character.magic_lifesteal);$("#character_helmet_container").empty().append(view_controller.generateItem(game.character.equipped_items.helmet,"equipped",null));$("#character_shoulders_container").empty().append(view_controller.generateItem(game.character.equipped_items.shoulders,"equipped",null));$("#character_gauntlets_container").empty().append(view_controller.generateItem(game.character.equipped_items.gauntlets,"equipped",null));$("#character_chest_container").empty().append(view_controller.generateItem(game.character.equipped_items.chest,"equipped",null));$("#character_belt_container").empty().append(view_controller.generateItem(game.character.equipped_items.belt,"equipped",null));$("#character_pants_container").empty().append(view_controller.generateItem(game.character.equipped_items.pants,"equipped",null));$("#character_boots_container").empty().append(view_controller.generateItem(game.character.equipped_items.boots,"equipped",null));$("#character_main_hand_container").empty().append(view_controller.generateItem(game.character.equipped_items.main_hand,"equipped",null));$("#character_off_hand_container").empty().append(view_controller.generateItem(game.character.equipped_items.off_hand,"equipped",null));$("#character_necklace_container").empty().append(view_controller.generateItem(game.character.equipped_items.necklace,"equipped",null));$("#character_ring1_container").append(view_controller.generateItem(game.character.equipped_items.ring1,"equipped",null));$("#character_ring2_container").append(view_controller.generateItem(game.character.equipped_items.ring2,"equipped",null));let $inventory=$("#inventory_container");$inventory.empty();for(let i=0;i<game.character.inventory.equipment.length;i++){$inventory.append(view_controller.generateItem(game.character.inventory.equipment[i],"inventory",{index:i}))}let $quest_list=$("#quest_list_container");$quest_list.empty();for(let i=0;i<game.character.quests.length;i++){$quest_list.append(view_controller.generateQuest(game.character.quests[i],"character"))}let $completed_quest_list=$("#completed_quest_list_container");$completed_quest_list.empty();for(let i=0;i<game.character.completed_quests.length;i++){$completed_quest_list.append(view_controller.generateQuest(game.character.completed_quests[i],"completed"))}let $upgrades_list=$("#upgrades_container");$upgrades_list.empty();for(let i=0;i<upgrades.length;i++){$upgrades_list.append(view_controller.generateUpgrade(upgrades[i]))}},updateSaveList:function(){let $load_game_select=$("#load_game_select");$load_game_select.empty();let saves=util.getSavesList();for(let i=0;i<saves.length;i++){let $save=$("<option></option>");if(i===0){$save.attr("selected",true)}$save.data("index",saves[i].index);let date=new Date(saves[i].time);$save.text(saves[i].index+" - "+date.getMonth()+"/"+date.getDate()+"/"+date.getFullYear()+" "+date.getHours()+":"+date.getMinutes()+":"+date.getSeconds());$load_game_select.append($save)}},updateOutput:function(){let $out=$("#output_container");$out.empty();for(let i=0;i<game.output.length;i++){$out.append(game.output[i]+"<br>")}$out.scrollTop($out[0].scrollHeight-$out[0].clientHeight)},updateContextMenu:function(){view_controller.updateSaveList();if(game.settings===STATUS.COMBAT_SPELL_SELECTED){$("#cancel_spell_button").hide()}else{$("#cancel_spell_button").show()}let $npc_shop_list_container=$("#npc_shop_list_container");$npc_shop_list_container.empty();if(util.isAround(game.character.x,game.character.y,"shop")){let points=util.getAround(game.character.x,game.character.y);for(let i=0;i<points.length;i++){if(map.get(points[i].x,points[i].y).npc!=null&&map.get(points[i].x,points[i].y).npc.type==="shop"){let items=map.get(points[i].x,points[i].y).npc.items;for(let j=0;j<items.length;j++){$npc_shop_list_container.append(view_controller.generateItem(items[j],"shop",{index:i,shop_x:points[i].x,shop_y:points[i].y}))}}}}let $npc_quest_list_container=$("#npc_quest_list_container");$npc_quest_list_container.empty();if(util.isAround(game.character.x,game.character.y,"quest_giver")){let points=util.getAround(game.character.x,game.character.y);for(let i=0;i<points.length;i++){if(map.get(points[i].x,points[i].y).npc!=null&&map.get(points[i].x,points[i].y).npc.type==="quest_giver"&&!util.isQuestCompleted(map.get(points[i].x,points[i].y).npc.quest)){$npc_quest_list_container.append(view_controller.generateQuest(map.get(points[i].x,points[i].y).npc.quest,"quest_giver"))}}}let $attack_list=$("#attack_list_container");$attack_list.empty();for(let i=0;i<game.character.attacks.length;i++){$attack_list.append(view_controller.generateSpell(game.character.attacks[i]))}},generateItem:function(item,mode,data){if(item==null){return}let $cont=$("<div></div>");$cont.addClass("$container");$cont.addClass("item_container");let $title_cont=$("<div></div>");$title_cont.css("width","49%");$title_cont.css("float","left");$title_cont.append("<h3>"+item.name+"</h3>");$title_cont.append("Value: "+item.value+"<br>");$title_cont.append("Description: "+item.description+"<br>");let $stats_cont=$("<div></div>");$stats_cont.css("width","49%");$stats_cont.css("float","right");if(mode==="equipped"){let $button=$('<button type="button">Unequip</button>');$button.css("float","right");$button.click(user_interface.unequipItem);$button.data("slot",item.slot);$stats_cont.append($button)}if(mode==="inventory"){if(item.slot==="ring"){let $button=$('<button type="button">Equip in Ring 2</button>');$button.css("float","right");$button.click(user_interface.equipItem);$button.data("ring",2);$button.data("index",data.index);$stats_cont.append($button);$button=$('<button type="button">Equip in Ring 1</button>');$button.css("float","right");$button.click(user_interface.equipItem);$button.data("ring",1);$button.data("index",data.index);$stats_cont.append($button)}else{let $button=$('<button type="button">Equip</button>');$button.css("float","right");$button.data("ring",0);$button.data("index",data.index);$button.click(user_interface.equipItem);$stats_cont.append($button)}if(util.isAround(game.character.x,game.character.y,"shop")){let $button=$('<button type="button">Sell Item</button>');$button.css("float","right");$button.data("index",data.index);$button.click(user_interface.sellItem);$stats_cont.append($button)}}if(mode==="shop"){let $button=$('<button type="button">Buy Item</button>');$button.css("float","right");$button.click(user_interface.buyItem);$button.data("index",data.index);$button.data("shop_x",data.shop_x);$button.data("shop_y",data.shop_y);$stats_cont.append($button)}$stats_cont.append("Max health: "+item.stats.max_health+"<br>");$stats_cont.append("Armor: "+item.stats.armor+"<br>");$stats_cont.append("Magic Resistance: "+item.stats.magic_resistance+"<br>");$stats_cont.append("Attack Power: "+item.stats.attack_power+"<br>");$stats_cont.append("Attack Lifesteal: "+item.stats.attack_lifesteal+"<br>");$stats_cont.append("Magic Power: "+item.stats.magic_power+"<br>");$stats_cont.append("Magic Lifesteal: "+item.stats.magic_lifesteal+"<br>");$stats_cont.append("Cooldown Reduction: "+item.stats.cooldown_reduction+"<br>");$stats_cont.append("Mana Regeneration: "+item.stats.mana_regeneration+"<br>");$stats_cont.append("Max Mana: "+item.stats.max_mana+"<br>");$cont.append($title_cont);$cont.append($stats_cont);return $cont},generateQuest:function(quest_name,mode){if(quest_name==null||mode==="quest_giver"&&util.hasQuest(quest_name)&&!util.hasQuestItem(quest_name)){return}let quest=util.getQuest(quest_name);let $cont=$("<div></div>");$cont.addClass("$container");$cont.addClass("item_container");let $title_cont=$("<div></div>");$title_cont.css("width","70%");$title_cont.css("float","left");$title_cont.append("<h3>"+quest.name+"</h3>");$title_cont.append("Goal Item: "+quest.goal_item+"<br>");$title_cont.append("Description: "+quest.description+"<br>");let $stats_cont=$("<div></div>");$stats_cont.css("width","29%");$stats_cont.css("float","right");if(mode==="quest_giver"){if(util.hasQuest(quest_name)&&util.hasQuestItem(quest_name)){let $button=$('<button type="button">Complete Quest</button>');$button.css("float","right");$button.click(user_interface.completeQuest);$button.data("quest_name",quest_name);$stats_cont.append($button)}else if(!util.hasQuest(quest_name)&&!util.isQuestCompleted(quest_name)){let $button=$('<button type="button">Accept Quest</button>');$button.css("float","right");$button.click(user_interface.acceptQuest);$button.data("quest_name",quest_name);$stats_cont.append($button)}}if(mode==="character"){let $button=$('<button type="button">Abandon Quest</button>');$button.css("float","right");$button.click(user_interface.abandonQuest);$button.data("quest_name",quest_name);$stats_cont.append($button);$stats_cont.append("Direction: "+util.directionToText(util.directionTowardGoalItem(quest_name))+"<br>")}$cont.append($title_cont);$cont.append($stats_cont);return $cont},generateUpgrade:function(upgrade_name){},generateQuestItem:function(quest_item_name){},generateSpell:function(attack_name){if(attack_name==null){return}let attack=character_attack.getAttack(attack_name);let $cont=$("<div></div>");$cont.addClass("$container");$cont.addClass("item_container");let $title_cont=$("<div></div>");$title_cont.css("width","90%");$title_cont.css("float","left");$title_cont.append("<h3>"+attack.name+"</h3>");$title_cont.append("Mana Cost: "+attack.mana_cost+"<br>");$title_cont.append("Cooldown: "+attack.cooldown+"<br>");$title_cont.append("Range: "+attack.range+"<br>");$title_cont.append("Description: "+attack.description+"<br>");let $stats_cont=$("<div></div>");$stats_cont.css("width","9%");$stats_cont.css("float","right");if(game.status===STATUS.COMBAT_SPELL_SELECTED){let $button=$('<button type="button">Cancel Spell</button>');$button.css("float","right");$button.click(user_interface.cancelSpell);$button.data("attack_name",attack_name);$stats_cont.append($button)}else{if(character_attack.hasManaFor(attack_name)&&character_attack.isOffCooldown(attack_name)){let $button=$('<button type="button">Use Attack</button>');$button.css("float","right");$button.click(user_interface.selectAttack);$button.data("attack_name",attack_name);$stats_cont.append($button)}}$cont.append($title_cont);$cont.append($stats_cont);return $cont}};